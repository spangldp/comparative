package interpreter;

import java.io.File;
import java.io.FileNotFoundException;
import java.util.HashMap;
import java.util.Map;
import java.util.Scanner;

import org.apache.commons.lang3.StringUtils;

public class Main {

	public static void main(String[] args) throws FileNotFoundException {
		Map<String, Object> vars = new HashMap<String, Object>();
		File inFile = new File(args[0]);
		@SuppressWarnings("resource")
		Scanner scanner = new Scanner(inFile);
		
		while(scanner.hasNext()){
			String line = scanner.nextLine();
			//tokenize
			String[] lineSplit = line.split(" ");
			if(lineSplit[0].equals("PRINT"))
				System.out.println(vars.get(lineSplit[1]));
			//initializing variables
			if(line.contains("=") && !line.contains("FOR ") && !line.contains("ENDFOR ")){
				String varName = lineSplit[0];
				String operand = lineSplit[1];
				String stringValue = lineSplit[2];
				
				//boolean str = false;
				if(operand.equals("=")){
					if(StringUtils.isNumeric(stringValue)){
						vars.put(varName, Integer.parseInt(stringValue));	
					}
					else if(!StringUtils.isNumeric(stringValue) && stringValue.charAt(0)==('\"') && stringValue.charAt(stringValue.length()-1)==('\"')){
						vars.put(varName, stringValue.substring(1,stringValue.length()-2));
					}
					else if(!StringUtils.isNumeric(stringValue) && !(stringValue.charAt(0)==('\"')) && !(stringValue.charAt(stringValue.length()-1)==('\"'))){
						vars.put(varName, vars.get(stringValue));
					}
				}
				else if(operand.equals("+=")){
					if(StringUtils.isNumeric(stringValue)){
						vars.put(varName, Integer.parseInt((String) vars.get(varName)) + Integer.parseInt(stringValue));	
					}
					else if(!StringUtils.isNumeric(stringValue) && stringValue.charAt(0)==('\"') && stringValue.charAt(stringValue.length()-1)==('\"')){
						vars.put(varName, vars.get(varName).toString()+stringValue.substring(1,stringValue.length()-2));
					}
					else if(!StringUtils.isNumeric(stringValue) && !(stringValue.charAt(0)==('\"')) && !(stringValue.charAt(stringValue.length()-1)==('\"'))){
						if(StringUtils.isNumeric(vars.get(varName).toString()))
							vars.put(varName, Integer.parseInt(vars.get(varName).toString()) + Integer.parseInt(vars.get(stringValue).toString()));
						else
							vars.put(varName, (String) vars.get(varName) + (String) vars.get(stringValue));

					}
				}
				else if(operand.equals("*=")){
					if(StringUtils.isNumeric(stringValue)){
						vars.put(varName, Integer.parseInt(vars.get(varName).toString()) * Integer.parseInt(stringValue));
					}
					else{
						vars.put(varName, Integer.parseInt((String) vars.get(varName)) * Integer.parseInt((String) vars.get(stringValue)));
					}
				}
				System.out.println("Line done");
			}
		}

	}

}
